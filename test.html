<!DOCTYPE html>
<html>
<head>
    <title>Chatbot Test</title>
    <meta charset="UTF-8">
</head>
<body>
<h1>Chatbot Test - Will's Waste LLC</h1>

<div id="chat-widget" style="width:500px;border:2px solid #007bff;padding:20px;border-radius:10px;">
  <div id="chat-log" style="height:300px;overflow-y:auto;padding:10px;background:#f5f5f5;margin-bottom:10px;border-radius:5px;"></div>
  <form id="chat-form" style="display:flex;gap:10px;">
    <input id="chat-input" type="text" placeholder="Ask about trash pickup..." style="flex:1;padding:10px;border:1px solid #ccc;border-radius:5px;">
    <button type="submit" style="padding:10px 20px;background:#007bff;color:white;border:none;border-radius:5px;cursor:pointer;">Send</button>
  </form>
  <div id="status" style="margin-top:10px;font-size:12px;color:#666;"></div>
</div>

<script>
const chatLog = document.getElementById('chat-log');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const status = document.getElementById('status');

// Add a test message on load
chatLog.innerHTML = '<div style="padding:5px;background:#e3f2fd;border-radius:5px;margin-bottom:5px;"><strong>System:</strong> Chatbot loaded. Try asking "What are your prices?"</div>';

chatForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const message = chatInput.value.trim();
  if (!message) return;

  // Show user message
  chatLog.innerHTML += `<div style="padding:5px;background:#fff3cd;border-radius:5px;margin-bottom:5px;"><strong>You:</strong> ${message}</div>`;
  chatInput.value = '';
  chatLog.scrollTop = chatLog.scrollHeight;
  
  status.textContent = 'Sending...';

  try {
    const res = await fetch("https://chatbot-business-1.onrender.com/chat", {
      method: "POST",
      headers: { 
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ message: message })
    });
    
    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`);
    }
    
    const data = await res.json();
    
    // Show bot response
    chatLog.innerHTML += `<div style="padding:5px;background:#d1ecf1;border-radius:5px;margin-bottom:5px;"><strong>Bot:</strong> ${data.reply || data.error || 'No response'}</div>`;
    status.textContent = 'Message sent!';
    
  } catch (error) {
    chatLog.innerHTML += `<div style="padding:5px;background:#f8d7da;border-radius:5px;margin-bottom:5px;"><strong>Error:</strong> ${error.message}</div>`;
    status.textContent = 'Error: ' + error.message;
    console.error('Full error:', error);
  }
  
  chatLog.scrollTop = chatLog.scrollHeight;
  
  setTimeout(() => {
    status.textContent = '';
  }, 3000);
});
</script>
</body>
</html>